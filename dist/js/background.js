(function(){var config,f;config={CONTEXTMENU_TEXT:"選択範囲をWeblioで検索",CONTEXTS:["selection"],SEND_MSG:{msg:"selection"},DIR_URL:"http://ejje.weblio.jp/content/",QUERY_FOR_WEBLIO:{currentWindow:!0,url:"http://ejje.weblio.jp/content/*"}},f={getSelectionWord:function(){var deferred;return deferred=Q.defer(),chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){return chrome.tabs.sendMessage(tabs[0].id,config.SEND_MSG,function(response){var searchUrl;return searchUrl=""+config.DIR_URL+response.word,deferred.resolve(searchUrl)})}),deferred.promise},hasAlreadyWeblio:function(){var deferred;return deferred=Q.defer(),chrome.tabs.query(config.QUERY_FOR_WEBLIO,function(tabs){return tabs.length>0?deferred.resolve(tabs[0]):deferred.reject()}),deferred.promise},openSelection:function(id,url){var deferred,query;return deferred=Q.defer(),query={url:url,active:!0},null!=id?chrome.tabs.update(id,query,function(){return deferred.resolve()}):chrome.tabs.create(query,function(){return deferred.resolve()}),deferred.promise},searchWeblio:function(){return f.getSelectionWord().then(function(url){return f.hasAlreadyWeblio().then(function(tab){return f.openSelection(tab.id,url)},function(){return f.openSelection(null,url)}).done()})}},chrome.contextMenus.create({title:config.CONTEXTMENU_TEXT,contexts:config.CONTEXTS,onclick:f.searchWeblio})}).call(this);